from metasploit.msfrpc import MsfRpcClient
from metasploit.msfconsole import MsfRpcConsole
import time
import json
from ..logging import *
global global_console_status
global global_positive_out
global_positive_out = list()
global_console_status = False
global assets
import modules

def initialise():
    global assets
    f = open('./app/assets.json', 'r')
    assets = json.loads(f.read())["assets"]
    MetasploitLog("Exploiting " + str(len(assets)) + " assets") 
    for i in range(len(assets)):
        exploitAsset(i)

def exploitAsset(index):
    global assets
    asset = assets[index]
    vulnerabilities = asset['Vulnerabilities']
    MetasploitLog("Asset " + asset['IP'] + " has " + str(len(asset['Vulnerabilities'])) + " vulnerabilities.")
    for vuln in vulnerabilities:
        if vuln['Vulnerability Type'] == 'SQL Injection':
            MetasploitLog("Found SQL Injection, exploiting.")
            modules.run(asset['IP'])

    

